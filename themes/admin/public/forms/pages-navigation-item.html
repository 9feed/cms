<div data---="modal__common.form2__if:pages-navigation-item;width:650;autofocus:true;submit:pagesnavigationitem/submit;reload:pagesnavigationitem/reload;scrollbar:true;$id:pagesnavigationitemmodal" class="hidden">

	<div>
		<span class="link cancel"><i class="fa fa-times"></i></span>
		<label><i class="fa fa-sitemap"></i>@(Navigation)</label>
	</div>

	<div>
		<div class="padding bg-smoke">
			<div data---="input__pages.navigationitem.url2__dirsource:pages.list;icon:sitemap;dirvalue:url">@(URL according to the sitemap)</div>
			<div class="help m"><i class="fa fa-refresh"></i>@(CMS will synchronizes all information automatically according to the page settings.)</div>
		</div>
		<hr class="nmt" />
		<div class="padding npt">
			<div class="row">
				<div class="col-md-8 m">
					<div data---="input__pages.navigationitem.name__required:true;maxlength:50">@(Name)</div>
				</div>
				<div class="col-md-4 m">
					<div data---="input__pages.navigationitem.language__dirsource:common.dependencies.languages">@(Language)</div>
				</div>
			</div>
			<div data---="input__pages.navigationitem.url__maxlength:500;required:true">@(URL address)</div>
			<div class="mt10 fs12"><span class="link exec" data-exec="pagesnavigationitem/file"><i class="fa fa-folder-o mr5"></i>@(Browse files)</span></div>
		</div>
		<hr class="nmt" />
		<div class="padding npt npb">
			<div class="row">
				<div class="col-md-6 m">
					<div data---="input__pages.navigationitem.target__dirsource:pagesnavigationitem.target;required:true__'_self'">@(Target)</div>
				</div>
				<div class="col-md-6 m">
					<div data---="input__pages.navigationitem.behaviour__dirsource:pagesnavigationitem.behaviour__'default'">@(Behaviour)</div>
				</div>
			</div>
			<div data---="input__pages.navigationitem.title__maxlength:100">@(Tooltip)</div>
		</div>
		<hr class="nmb" />
		<div class="padding bg-yellow">
			<div class="mt5" data---="fontawesomebox__pages.navigationitem.icon__search:@(Search icons);height:152"></div>
		</div>
	</div>

	<div>
		<div data---="validation__pages.navigationitem">
			<span class="link cancel">@(Cancel)</span>
			<button name="submit">@(APPLY)</button>
		</div>
	</div>

</div>

<script>

	PLUGIN('pagesnavigationitem', function(exports) {

		SET('pagesnavigationitem.target', [{ name: '@(Current tab or window)', id: '_self' },{ name: '@(New tab or window)', id: '_blank' }]);
		SET('pagesnavigationitem.behaviour', [{ name: '@(Default)', id: 'default' },{ name: '@(Highlight)', id: 'highlight' },{ name: '@(Info)', id: 'info' },{ name: '@(Warning)', id: 'warn' },{ name: '@(Special)', id: 'special' }]);

		exports.reload = function() {
			setTimeout2('pagesnavigationitem', function() {
				SETTER('#pagesnavigationitemmodal', 'resize');
			}, 500);
		};

		exports.file = function() {
			refresh_filebrowser('pages.navigationitem.url');
		};

		exports.submit = function() {

			var obj = pages.navigationitem;
			var page = pages.grid.items.findItem('url', obj.url);

			obj.idpage = page ? page.id : null;

			if (obj.id) {
				var index = obj.$target.findIndex('id', obj.id);
				obj.$target[index] = obj;
				obj.$target = undefined;
			} else {
				obj.id = GUID(10);
				obj.$target.push(obj);
				obj.$target = undefined;
			}

			hide();

			// Notifies parent
			UPDATE('pages.navigation.children');
			CHANGE('pages.navigation.children', true);
		};

		WATCH('pages.navigationitem.url2', function(path, value, type) {
			value && type === 2 && SET('pages.navigationitem.url', value, 2);
		});

		WATCH('pages.navigationitem.url', function(path, value, type) {

			SET('pages.navigationitem.url2', value);
			if (type === 2 && pages.navigationitem.target !== '_blank' && (/^(http|https)\:\/\//i).test(value))
				SET('cmseditor.link.target', '_blank');

			if (type === 2) {
				var item = pages.grid.items.findItem('url', value);
				if (item) {
					var tmp = GET('pages.navigationitem');
					tmp.name = item.name;
					tmp.icon = item.icon;
					tmp.title = item.title;
					tmp.language = item.language;
					UPDATE('pages.navigationitem');
				}
			}
		}, true);
	});
</script>
