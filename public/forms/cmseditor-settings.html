<div data---="form__cmseditor.form__if:settings;width:500;submit:cmseditorsettings/submit;icon:cog;title:@(Widget settings)" class="hidden">

	<div class="padding" id="settings-multioptions">
		<div data---="multioptions__cmseditor.settings.options__$id:cmseditor.settings"></div>
	</div>
	<nav>
		<button name="submit">@(APPLY)</button>
		<button name="cancel">@(Cancel)</button>
	</nav>

</div>

<script>

	PLUGIN('cmseditorsettings', function(exports) {
		exports.submit = function(hide) {
			hide();
			setTimeout(function() {

				var form = cmseditor.settings;
				var prev = cmseditor.widgetsettings[form.id];
				var dep = FIND('#cmseditor.settings').dependencies();

				// dep === Code lists

				form.exports.configure && form.exports.configure.call(dep, form.options, cmseditor.settings.target, prev);
				cmseditor.widgetsettings[form.id] = form.options;
				var editor = cmseditor.instance;
				editor.change(true);

				setTimeout(function() {
					editor.autoresize();
				}, 500);

				var target = editor.getTarget();
				editor.setTarget(null);
				target && target.trigger('click');
			}, 1200);
		};
	});

	WATCH('cmseditor.settings.options', function(path, value) {
		var height = $('#settings-multioptions').innerHeight();
		setTimeout2('settingsoptions', function() {
			SETTER(true, 'modal', 'reconfigure', 'height:' + height);
		}, 400);
	});

</script>